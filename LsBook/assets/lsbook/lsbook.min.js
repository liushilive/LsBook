!function(window,document,undefined){if(window){for(var _REVERSE_MAP,_MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},i=1;i<20;++i)_MAP[111+i]="f"+i;for(i=0;i<=9;++i)_MAP[i+96]=i.toString();Mousetrap.prototype.bind=function(keys,callback,action){keys=keys instanceof Array?keys:[keys];this._bindMultiple.call(this,keys,callback,action);return this};Mousetrap.prototype.unbind=function(keys,action){return this.bind.call(this,keys,function(){},action)};Mousetrap.prototype.trigger=function(keys,action){this._directMap[keys+":"+action]&&this._directMap[keys+":"+action]({},keys);return this};Mousetrap.prototype.reset=function(){this._callbacks={};this._directMap={};return this};Mousetrap.prototype.stopCallback=function(e,element){if(-1<(" "+element.className+" ").indexOf(" mousetrap "))return!1;if(function _belongsTo(element,ancestor){return null!==element&&element!==document&&(element===ancestor||_belongsTo(element.parentNode,ancestor))}(element,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var initialEventTarget=e.composedPath()[0];initialEventTarget!==e.target&&(element=initialEventTarget)}return"INPUT"==element.tagName||"SELECT"==element.tagName||"TEXTAREA"==element.tagName||element.isContentEditable};Mousetrap.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)};Mousetrap.addKeycodes=function(object){for(var key in object)object.hasOwnProperty(key)&&(_MAP[key]=object[key]);_REVERSE_MAP=null};Mousetrap.init=function(){var documentMousetrap=Mousetrap(document);for(var method in documentMousetrap)"_"!==method.charAt(0)&&(Mousetrap[method]=function(method){return function(){return documentMousetrap[method].apply(documentMousetrap,arguments)}}(method))};Mousetrap.init();window.Mousetrap=Mousetrap;"undefined"!=typeof module&&module.exports&&(module.exports=Mousetrap);"function"==typeof define&&define.amd&&define(function(){return Mousetrap})}function _addEvent(object,type,callback){object.addEventListener?object.addEventListener(type,callback,!1):object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if("keypress"!=e.type)return _MAP[e.which]?_MAP[e.which]:_KEYCODE_MAP[e.which]?_KEYCODE_MAP[e.which]:String.fromCharCode(e.which).toLowerCase();var character=String.fromCharCode(e.which);e.shiftKey||(character=character.toLowerCase());return character}function _isModifier(key){return"shift"==key||"ctrl"==key||"alt"==key||"meta"==key}function _pickBestAction(key,modifiers,action){action||(action=function(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP)95<key&&key<112||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key)}return _REVERSE_MAP}()[key]?"keydown":"keypress");"keypress"==action&&modifiers.length&&(action="keydown");return action}function _getKeyInfo(combination,action){var keys,key,i,modifiers=[];keys=function(combination){return"+"===combination?["+"]:(combination=combination.replace(/\+{2}/g,"+plus")).split("+")}(combination);for(i=0;i<keys.length;++i){key=keys[i];_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]);if(action&&"keypress"!=action&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push("shift")}_isModifier(key)&&modifiers.push(key)}return{key:key,modifiers:modifiers,action:action=_pickBestAction(key,modifiers,action)}}function Mousetrap(targetElement){var self=this;targetElement=targetElement||document;if(!(self instanceof Mousetrap))return new Mousetrap(targetElement);self.target=targetElement;self._callbacks={};self._directMap={};var _resetTimer,_sequenceLevels={},_ignoreNextKeyup=!1,_ignoreNextKeypress=!1,_nextExpectedAction=!1;function _resetSequences(doNotReset){doNotReset=doNotReset||{};var key,activeSequences=!1;for(key in _sequenceLevels)doNotReset[key]?activeSequences=!0:_sequenceLevels[key]=0;activeSequences||(_nextExpectedAction=!1)}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i,callback,modifiers1,modifiers2,matches=[],action=e.type;if(!self._callbacks[character])return[];"keyup"==action&&_isModifier(character)&&(modifiers=[character]);for(i=0;i<self._callbacks[character].length;++i){callback=self._callbacks[character][i];if((sequenceName||!callback.seq||_sequenceLevels[callback.seq]==callback.level)&&(action==callback.action&&("keypress"==action&&!e.metaKey&&!e.ctrlKey||(modifiers1=modifiers,modifiers2=callback.modifiers,modifiers1.sort().join(",")===modifiers2.sort().join(","))))){var deleteCombo=!sequenceName&&callback.combo==combination,deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;(deleteCombo||deleteSequence)&&self._callbacks[character].splice(i,1);matches.push(callback)}}return matches}function _fireCallback(callback,e,combo,sequence){if(!self.stopCallback(e,e.target||e.srcElement,combo,sequence)&&!1===callback(e,combo)){!function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(e);!function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(e)}}self._handleKey=function(character,modifiers,e){var i,callbacks=_getMatches(character,modifiers,e),doNotReset={},maxLevel=0,processedSequenceCallback=!1;for(i=0;i<callbacks.length;++i)callbacks[i].seq&&(maxLevel=Math.max(maxLevel,callbacks[i].level));for(i=0;i<callbacks.length;++i)if(callbacks[i].seq){if(callbacks[i].level!=maxLevel)continue;processedSequenceCallback=!0;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq)}else processedSequenceCallback||_fireCallback(callbacks[i].callback,e,callbacks[i].combo);var ignoreThisKeypress="keypress"==e.type&&_ignoreNextKeypress;e.type!=_nextExpectedAction||_isModifier(character)||ignoreThisKeypress||_resetSequences(doNotReset);_ignoreNextKeypress=processedSequenceCallback&&"keydown"==e.type};function _handleKeyEvent(e){"number"!=typeof e.which&&(e.which=e.keyCode);var character=_characterFromEvent(e);character&&("keyup"!=e.type||_ignoreNextKeyup!==character?self.handleKey(character,function(e){var modifiers=[];e.shiftKey&&modifiers.push("shift");e.altKey&&modifiers.push("alt");e.ctrlKey&&modifiers.push("ctrl");e.metaKey&&modifiers.push("meta");return modifiers}(e),e):_ignoreNextKeyup=!1)}function _bindSequence(combo,keys,callback,action){function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];!function(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1e3)}()}}function _callbackAndReset(e){_fireCallback(callback,e,combo);"keyup"!==action&&(_ignoreNextKeyup=_characterFromEvent(e));setTimeout(_resetSequences,10)}for(var i=_sequenceLevels[combo]=0;i<keys.length;++i){var wrappedCallback=i+1===keys.length?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _bindSingle(combination,callback,action,sequenceName,level){self._directMap[combination+":"+action]=callback;var info,sequence=(combination=combination.replace(/\s+/g," ")).split(" ");if(1<sequence.length)_bindSequence(combination,sequence,callback,action);else{info=_getKeyInfo(combination,action);self._callbacks[info.key]=self._callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);self._callbacks[info.key][sequenceName?"unshift":"push"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination})}}self._bindMultiple=function(combinations,callback,action){for(var i=0;i<combinations.length;++i)_bindSingle(combinations[i],callback,action)};_addEvent(targetElement,"keypress",_handleKeyEvent);_addEvent(targetElement,"keydown",_handleKeyEvent);_addEvent(targetElement,"keyup",_handleKeyEvent)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null);function absolute(base,relative){var stack=base.split("/"),parts=relative.split("/");stack.pop();for(var i=0;i<parts.length;i++)"."!=parts[i]&&(".."==parts[i]?stack.pop():stack.push(parts[i]));return stack.join("/")}var events=$({}),baseKey="",storage={setBaseKey:function(key){baseKey=key},set:function(key,value){key=baseKey+":"+key;try{localStorage[key]=JSON.stringify(value)}catch(e){}},get:function(key,def){var value;key=baseKey+":"+key;try{value=localStorage[key]}catch(e){}if(void 0===value)return def;try{var parsed=JSON.parse(value);return null==parsed?def:parsed}catch(err){return value||def}},remove:function(key){key=baseKey+":"+key;try{localStorage.removeItem(key)}catch(e){}}},started=!1,state={};function setState(newState){state.page=newState.page;state.file=newState.file;state.config=newState.config;state.basePath=newState.basePath;state.book=newState.book;state.$book=$(".book");state.root=absolute(location.protocol+"//"+location.host+location.pathname,state.basePath)}var page={hasChanged:function(ctx){console.log("page has changed",ctx);setState(ctx);if(!started){started=!0;events.trigger("start",ctx.config)}events.trigger("page.change")},setState:setState,getState:function(){return state}},isPageReady=!1,onLoad=window.lsbook||[],lsbook={events:events,page:page,state:page.getState(),storage:storage,push:function(fn){isPageReady?fn():onLoad.push(fn)}};window.lsbook=lsbook;$(document).ready(function(){isPageReady=!0;$.each(onLoad,function(i,fn){fn()})});function toggleDropdown(e){$(e.currentTarget).parent().find(".dropdown-menu").toggleClass("open");e.stopPropagation();e.preventDefault()}function closeDropdown(e){$(".dropdown-menu").removeClass("open")}var dropdown_init=function(){$(document).on("click",".toggle-dropdown",toggleDropdown);$(document).on("click",".dropdown-menu",function(e){e.stopPropagation()});$(document).on("click",closeDropdown)};function bindShortcut(keys,fn){Mousetrap.bind(keys,function(e){fn();return!1})}var $chapters,$activeChapter,keyboard={init:function(){bindShortcut(["right"],function(e){navigation.goNext()});bindShortcut(["left"],function(e){navigation.goPrev()});bindShortcut(["s"],function(e){sidebar.toggle()})}},loading={show:function(p){lsbook.state.$book.addClass("is-loading");p.always(function(){lsbook.state.$book.removeClass("is-loading")});return p}},platform={isMobile:function(){return $(document).width()<=600},isSmallScreen:function(){return $(document).width()<=1240}},usePushState=void 0!==history.pushState;function getScroller(){return platform.isSmallScreen()?$(".book-body"):$(".body-inner")}function scrollToHash(hash){var $scroller=getScroller(),dest=0;if(function(id){return!!getScroller().find(id).length}(hash)){hash&&(dest=getElementTopPosition(hash));$scroller.unbind("scroll");$scroller.animate({scrollTop:dest},800,"swing",function(){$scroller.scroll(handleScrolling)});setChapterActive(null,hash)}}function isEmpty(element){return 0===element.length}function getElementTopPosition(id){var $scroller=getScroller(),$container=$scroller.find(".page-inner"),$el=$scroller.find(id),$parent=$el.offsetParent(),dest=0;if(function(arr,predicate){return 0<arr.length&&0<arr.filter(predicate).length}([$scroller,$container,$el,$parent],isEmpty))return 0;dest=$el.position().top;for(var i=0;i<10&&(!$parent.is($container)&&!$parent.is($parent.offsetParent()));i++){dest+=($el=$parent).position().top;$parent=$el.offsetParent()}return Math.floor(dest)}function setChapterActive($chapter,hash){$chapter||hash||($chapter=$chapters.first());hash&&($chapter=1<$chapters.length?$chapters.filter(function(){return getChapterHash($(this))==hash}).first():$chapters.first());if(!$chapter.is($activeChapter)){$activeChapter=$chapter;$chapters.removeClass("active");$chapter.addClass("active");hash=getChapterHash($chapter);var oldUri=window.location.pathname+window.location.hash,uri=window.location.pathname+hash;uri!=oldUri&&history.replaceState({path:uri},null,uri)}}function getChapterHash($chapter){var hash=$chapter.children("a").attr("href").split("#")[1];hash&&(hash="#"+hash);return hash||""}function handleScrolling(){var $scroller=getScroller(),scrollTop=$scroller.scrollTop(),scrollHeight=$scroller.prop("scrollHeight"),clientHeight=$scroller.prop("clientHeight"),nbChapters=$chapters.length,$chapter=null;$($chapters.get().reverse()).each(function(index){var titleId=getChapterHash($(this));titleId&&!$chapter&&getElementTopPosition(titleId)<=scrollTop&&($chapter=$(this));index!=nbChapters-1||$chapter||($chapter=$(this))});$chapter||scrollTop||($chapter=$chapters.first());scrollTop&&scrollHeight-scrollTop==clientHeight&&($chapter=$chapters.last());setChapterActive($chapter)}var prevUri=location.href;function handleNavigation(relativeUrl,push){var prevUriParsed=$("<a>",{href:prevUri}),uri=absolute(window.location.pathname,relativeUrl),uriParsed=$("<a>",{href:uri}),hash=uriParsed.prop("hash"),pathHasChanged=uriParsed.prop("pathname")!==prevUriParsed.prop("pathname"),isAbsolute=new RegExp("^(?:[a-z]+:)?//","i").test(relativeUrl);if(usePushState&&!isAbsolute){if(!pathHasChanged){push&&history.pushState({path:uri},null,uri);return scrollToHash(hash)}prevUri=uri;var promise=$.Deferred(function(deferred){$.ajax({type:"GET",url:uri,cache:!0,headers:{"Access-Control-Expose-Headers":"X-Current-Location"},success:function(html,status,xhr){var responseURL=xhr.getResponseHeader("X-Current-Location")||uri;html=html.replace(/<(\/?)(html|head|body)([^>]*)>/gi,function(a,b,c,d){return"<"+b+"div"+(b?"":' data-element="'+c+'"')+d+">"});var $pageHead,$page=$(html),$pageBody=$page.find(".book");if(0===$pageBody.length){var err=new Error("无效的页面，正在重定向...");return deferred.reject(err)}push&&history.pushState({path:responseURL},null,responseURL);$pageHead=($page=$(html)).find("[data-element=head]");$pageBody=$page.find(".book");document.title=$pageHead.find("title").text();var $head=$("head");$head.find("link[rel=prev]").remove();$head.find("link[rel=next]").remove();$head.append($pageHead.find("link[rel=prev]"));$head.append($pageHead.find("link[rel=next]"));var bodyClass=$(".book").attr("class"),scrollPosition=$(".book-summary").scrollTop();$pageBody.toggleClass("with-summary",$(".book").hasClass("with-summary"));$(".book").replaceWith($pageBody);$(".book").attr("class",bodyClass);$(".book-summary").scrollTop(scrollPosition);lsbook.state.$book=$(".book");preparePage(!hash);hash&&scrollToHash(hash);deferred.resolve()}})}).promise();return loading.show(promise.fail(function(e){console.log(e)}))}location.href=relativeUrl}function updateNavigationPosition(){var bodyInnerWidth,pageWrapperWidth;bodyInnerWidth=parseInt($(".body-inner").css("width"),10);pageWrapperWidth=parseInt($(".page-wrapper").css("width"),10);$(".navigation-next").css("margin-right",bodyInnerWidth-pageWrapperWidth+"px");var $scroller=getScroller();$scroller.unbind("scroll");$scroller.scroll(handleScrolling)}function preparePage(resetScroll){var $pageWrapper=$(".book-body").find(".body-inner").find(".page-wrapper");updateNavigationPosition();$pageWrapper.focus();var $scroller=getScroller();!1!==resetScroll&&$scroller.scrollTop(0);1<($chapters=$(".book-summary .summary .chapter").filter(function(){var $link=$(this).children("a"),href=null;if(!$link.length)return!1;href=$link.attr("href").split("#")[0];var resolvedRef=absolute(window.location.pathname,href);return window.location.pathname==resolvedRef})).length?$scroller.scroll(handleScrolling):$activeChapter=$chapters.first()}function handleLinkClick(e){var $this=$(this),target=$this.attr("target");if(!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)&&function(e){return 0===e.button}(e)&&!target){e.stopPropagation();e.preventDefault();var url=$this.attr("href");url&&handleNavigation(url,!0)}}var navigation={init:function(){$.ajaxSetup({cache:!1});history.replaceState({path:window.location.href},"");window.onpopstate=function(event){if(null!==event.state)return handleNavigation(event.state.path,!1)};$(document).on("click",".navigation-prev",handleLinkClick);$(document).on("click",".navigation-next",handleLinkClick);$(document).on("click",".summary [data-path] a",handleLinkClick);$(document).on("click",".page-inner a",handleLinkClick);$(window).resize(updateNavigationPosition);preparePage(!1)},goNext:function(){var url=$(".navigation-next").attr("href");url&&handleNavigation(url,!0)},goPrev:function(){var url=$(".navigation-prev").attr("href");url&&handleNavigation(url,!0)}};function toggleSidebar(_state,animation){if(null==lsbook.state||isOpen()!=_state){null==animation&&(animation=!0);lsbook.state.$book.toggleClass("without-animation",!animation);lsbook.state.$book.toggleClass("with-summary",_state);lsbook.storage.set("sidebar",isOpen())}}function isOpen(){return lsbook.state.$book.hasClass("with-summary")}var sidebar={init:function(){platform.isMobile()||toggleSidebar(lsbook.storage.get("sidebar",!0),!1);$(document).on("click",".book-summary li.chapter a",function(e){platform.isMobile()&&toggleSidebar(!1,!1)})},isOpen:isOpen,toggle:toggleSidebar,filter:function(paths){$(".book-summary").find("li").each(function(){var path=$(this).data("path"),st=null==paths||-1!==paths.indexOf(path);$(this).toggle(st);st&&$(this).parents("li").show()})}},buttons=[],BTN_ID=0;function defaultOnClick(e){e.preventDefault()}function updateButton(opts){var $result,$toolbar=$(".book-header"),$title=$toolbar.find("h1"),positionClass="pull-"+opts.position,$btn=$("<a>",{class:"btn",text:opts.text?" "+opts.text:"","aria-label":opts.label,href:"#"});$btn.click(opts.onClick);opts.icon&&$("<i>",{class:opts.icon}).prependTo($btn);if(opts.dropdown){var $container=$("<div>",{class:"dropdown "+positionClass+" "+opts.className});$btn.addClass("toggle-dropdown");$container.append($btn);var $menu=function(dropdown){var $menu=$("<div>",{class:"dropdown-menu",html:'<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>'});"string"==typeof dropdown?$menu.append(dropdown):dropdown.map(function(group){return $.isArray(group)?group:[group]}).forEach(function(group){var $group=$("<div>",{class:"buttons"}),sizeClass="size-"+group.length;group.forEach(function(btn){btn=$.extend({text:"",className:"",onClick:defaultOnClick},btn||{});var $btn=$("<button>",{class:"button "+sizeClass+" "+btn.className,text:btn.text});$btn.click(btn.onClick);$group.append($btn)});$menu.append($group)});return $menu}(opts.dropdown);$menu.addClass("dropdown-"+("right"==opts.position?"left":"right"));$container.append($menu);$result=$container}else{$btn.addClass(positionClass);$btn.addClass(opts.className);$result=$btn}$result.addClass("js-toolbar-action");$.isNumeric(opts.index)&&0<=opts.index?function(parent,selector,index,element){var lastIndex=parent.children(selector).length;index<0&&(index=Math.max(0,lastIndex+1+index));parent.append(element);index<lastIndex&&parent.children(selector).eq(index).before(parent.children(selector).last())}($toolbar,".btn, .dropdown, h1",opts.index,$result):$result.insertBefore($title)}function updateAllButtons(){$(".js-toolbar-action").remove();buttons.forEach(updateButton)}lsbook.events.on("page.change",function(){updateAllButtons()});var toolbar={createButton:function(opts){opts=$.extend({label:"",icon:"",text:"",position:"left",className:"",onClick:defaultOnClick,dropdown:null,index:null,id:"btn-"+BTN_ID++},opts||{});buttons.push(opts);updateButton(opts);return opts.id},removeButton:function(id){buttons=$.grep(buttons,function(button){return button.id!=id});updateAllButtons()},removeButtons:function(ids){buttons=$.grep(buttons,function(button){return-1==ids.indexOf(button.id)});updateAllButtons()}};lsbook.events.on("start",function(){sidebar.init();keyboard.init();dropdown_init();navigation.init();toolbar.createButton({index:0,icon:"fa fa-align-justify",onClick:function(e){e.preventDefault();sidebar.toggle()}})});lsbook.keyboard=keyboard;lsbook.navigation=navigation;lsbook.sidebar=sidebar;lsbook.toolbar=toolbar;
//# sourceMappingURL=lsbook.min.js.map