!function(window,document){if(window){for(var _REVERSE_MAP,_MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},i=1;i<20;++i)_MAP[111+i]="f"+i;for(i=0;i<=9;++i)_MAP[i+96]=i.toString();Mousetrap.prototype.bind=function(keys,callback,action){keys=keys instanceof Array?keys:[keys];this._bindMultiple.call(this,keys,callback,action);return this};Mousetrap.prototype.unbind=function(keys,action){return this.bind.call(this,keys,function(){},action)};Mousetrap.prototype.trigger=function(keys,action){this._directMap[keys+":"+action]&&this._directMap[keys+":"+action]({},keys);return this};Mousetrap.prototype.reset=function(){this._callbacks={};this._directMap={};return this};Mousetrap.prototype.stopCallback=function(e,element){if(-1<(" "+element.className+" ").indexOf(" mousetrap "))return!1;if(function _belongsTo(element,ancestor){return null!==element&&element!==document&&(element===ancestor||_belongsTo(element.parentNode,ancestor))}(element,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var initialEventTarget=e.composedPath()[0];initialEventTarget!==e.target&&(element=initialEventTarget)}return"INPUT"==element.tagName||"SELECT"==element.tagName||"TEXTAREA"==element.tagName||element.isContentEditable};Mousetrap.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)};Mousetrap.addKeycodes=function(object){for(var key in object)object.hasOwnProperty(key)&&(_MAP[key]=object[key]);_REVERSE_MAP=null};Mousetrap.init=function(){var documentMousetrap=Mousetrap(document);for(var method in documentMousetrap)"_"!==method.charAt(0)&&(Mousetrap[method]=function(method){return function(){return documentMousetrap[method].apply(documentMousetrap,arguments)}}(method))};Mousetrap.init();window.Mousetrap=Mousetrap;"undefined"!=typeof module&&module.exports&&(module.exports=Mousetrap);"function"==typeof define&&define.amd&&define(function(){return Mousetrap})}function _addEvent(object,type,callback){object.addEventListener?object.addEventListener(type,callback,!1):object.attachEvent("on"+type,callback)}function _characterFromEvent(e){if("keypress"!=e.type)return _MAP[e.which]?_MAP[e.which]:_KEYCODE_MAP[e.which]?_KEYCODE_MAP[e.which]:String.fromCharCode(e.which).toLowerCase();var character=String.fromCharCode(e.which);e.shiftKey||(character=character.toLowerCase());return character}function _isModifier(key){return"shift"==key||"ctrl"==key||"alt"==key||"meta"==key}function _pickBestAction(key,modifiers,action){"keypress"==(action=action||(function(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP)95<key&&key<112||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key)}return _REVERSE_MAP}()[key]?"keydown":"keypress"))&&modifiers.length&&(action="keydown");return action}function _getKeyInfo(combination,action){var keys,key,i,modifiers=[];keys=function(combination){return"+"===combination?["+"]:(combination=combination.replace(/\+{2}/g,"+plus")).split("+")}(combination);for(i=0;i<keys.length;++i){key=keys[i];_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]);if(action&&"keypress"!=action&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push("shift")}_isModifier(key)&&modifiers.push(key)}return{key:key,modifiers:modifiers,action:action=_pickBestAction(key,modifiers,action)}}function Mousetrap(targetElement){var self=this;targetElement=targetElement||document;if(!(self instanceof Mousetrap))return new Mousetrap(targetElement);self.target=targetElement;self._callbacks={};self._directMap={};var _resetTimer,_sequenceLevels={},_ignoreNextKeyup=!1,_ignoreNextKeypress=!1,_nextExpectedAction=!1;function _resetSequences(doNotReset){doNotReset=doNotReset||{};var key,activeSequences=!1;for(key in _sequenceLevels)doNotReset[key]?activeSequences=!0:_sequenceLevels[key]=0;activeSequences||(_nextExpectedAction=!1)}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i,callback,modifiers1,modifiers2,matches=[],action=e.type;if(!self._callbacks[character])return[];"keyup"==action&&_isModifier(character)&&(modifiers=[character]);for(i=0;i<self._callbacks[character].length;++i){callback=self._callbacks[character][i];if((sequenceName||!callback.seq||_sequenceLevels[callback.seq]==callback.level)&&(action==callback.action&&("keypress"==action&&!e.metaKey&&!e.ctrlKey||(modifiers1=modifiers,modifiers2=callback.modifiers,modifiers1.sort().join(",")===modifiers2.sort().join(","))))){var deleteCombo=!sequenceName&&callback.combo==combination,deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;(deleteCombo||deleteSequence)&&self._callbacks[character].splice(i,1);matches.push(callback)}}return matches}function _fireCallback(callback,e,combo,sequence){if(!self.stopCallback(e,e.target||e.srcElement,combo,sequence)&&!1===callback(e,combo)){!function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(e);!function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(e)}}self._handleKey=function(character,modifiers,e){var i,callbacks=_getMatches(character,modifiers,e),doNotReset={},maxLevel=0,processedSequenceCallback=!1;for(i=0;i<callbacks.length;++i)callbacks[i].seq&&(maxLevel=Math.max(maxLevel,callbacks[i].level));for(i=0;i<callbacks.length;++i)if(callbacks[i].seq){if(callbacks[i].level!=maxLevel)continue;processedSequenceCallback=!0;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq)}else processedSequenceCallback||_fireCallback(callbacks[i].callback,e,callbacks[i].combo);var ignoreThisKeypress="keypress"==e.type&&_ignoreNextKeypress;e.type!=_nextExpectedAction||_isModifier(character)||ignoreThisKeypress||_resetSequences(doNotReset);_ignoreNextKeypress=processedSequenceCallback&&"keydown"==e.type};function _handleKeyEvent(e){"number"!=typeof e.which&&(e.which=e.keyCode);var character=_characterFromEvent(e);character&&("keyup"!=e.type||_ignoreNextKeyup!==character?self.handleKey(character,function(e){var modifiers=[];e.shiftKey&&modifiers.push("shift");e.altKey&&modifiers.push("alt");e.ctrlKey&&modifiers.push("ctrl");e.metaKey&&modifiers.push("meta");return modifiers}(e),e):_ignoreNextKeyup=!1)}function _bindSequence(combo,keys,callback,action){function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];!function(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1e3)}()}}function _callbackAndReset(e){_fireCallback(callback,e,combo);"keyup"!==action&&(_ignoreNextKeyup=_characterFromEvent(e));setTimeout(_resetSequences,10)}for(var i=_sequenceLevels[combo]=0;i<keys.length;++i){var wrappedCallback=i+1===keys.length?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _bindSingle(combination,callback,action,sequenceName,level){self._directMap[combination+":"+action]=callback;var info,sequence=(combination=combination.replace(/\s+/g," ")).split(" ");if(1<sequence.length)_bindSequence(combination,sequence,callback,action);else{info=_getKeyInfo(combination,action);self._callbacks[info.key]=self._callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);self._callbacks[info.key][sequenceName?"unshift":"push"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination})}}self._bindMultiple=function(combinations,callback,action){for(var i=0;i<combinations.length;++i)_bindSingle(combinations[i],callback,action)};_addEvent(targetElement,"keypress",_handleKeyEvent);_addEvent(targetElement,"keydown",_handleKeyEvent);_addEvent(targetElement,"keyup",_handleKeyEvent)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null);var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g;var punycode={toASCII:function(input){return this.mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})},mapDomain:function(string,fn){var parts=string.split("@"),result="";if(1<parts.length){result=parts[0]+"@";string=parts[1]}var labels=(string=string.replace(regexSeparators,".")).split(".");return result+this.map(labels,fn).join(".")},map:function(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}};function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var querystring_stringify=function(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];inputLength=(input=ucs2decode(input)).length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));handledCPCount=basicLength=output.length;basicLength&&output.push(delimiter);for(;handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)n<=(currentValue=input[j])&&currentValue<m&&(m=currentValue);handledCPCountPlusOne=handledCPCount+1;m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow");delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){(currentValue=input[j])<n&&++delta>maxInt&&error("overflow");if(currentValue==n){for(q=delta,k=base;!(q<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias));k+=base){qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")},querystring_parse=function(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;(basic=input.lastIndexOf(delimiter))<0&&(basic=0);for(j=0;j<basic;++j){128<=input.charCodeAt(j)&&error("not-basic");output.push(input.charCodeAt(j))}for(index=0<basic?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){inputLength<=index&&error("invalid-input");((digit=basicToDigit(input.charCodeAt(index++)))>=base||digit>floor((maxInt-i)/w))&&error("overflow");i+=digit*w;if(digit<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias))break;baseMinusT=base-t;w>floor(maxInt/baseMinusT)&&error("overflow");w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,0==oldi);floor(i/out)>maxInt-n&&error("overflow");n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)};Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0);relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}result.hash=relative.hash;if(""===relative.href){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/");result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}result.href=result.format();return result}result.protocol=relative.protocol;if(relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host="");relative.hostname||(relative.hostname="");""!==relPath[0]&&relPath.unshift("");relPath.length<2&&relPath.unshift("");result.pathname=relPath.join("/")}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic){result.hostname="";result.port=null;result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host));result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host));relative.host=null}mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])}if(isRelAbs){result.host=relative.host||""===relative.host?relative.host:result.host;result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){(srcPath=srcPath||[]).pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();if(authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@")){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:""));result.href=result.format();return result}if(!srcPath.length){result.pathname=null;result.search?result.path="/"+result.search:result.path=null;result.href=result.format();return result}for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||1<srcPath.length)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;0<=i;i--)if("."===(last=srcPath[i]))srcPath.splice(i,1);else if(".."===last){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}if(!mustEndAbs&&!removeAllDots)for(;up--;)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift("");hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost;if(authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@")){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift("");if(srcPath.length)result.pathname=srcPath.join("/");else{result.pathname=null;result.path=null}util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:""));result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()};Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";if(this.host)host=auth+this.host;else if(this.hostname){host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]");this.port&&(host+=":"+this.port)}this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring_stringify(this.query));var search=this.search||query&&"?"+query||"";protocol&&":"!==protocol.substr(-1)&&(protocol+=":");if(this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host){host="//"+(host||"");pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)}else host=host||"";hash&&"#"!==hash.charAt(0)&&(hash="#"+hash);search&&"?"!==search.charAt(0)&&(search="?"+search);return protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(search=search.replace("#","%23"))+hash};Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);rest=rest.trim();if(!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];this.query=parseQueryString?querystring_parse(this.search.substr(1)):this.search.substr(1)}else if(parseQueryString){this.search="";this.query={}}return this}}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);if(slashes&&(!proto||!hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=!0}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}if(-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length);this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)127<part.charCodeAt(j)?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}notHost.length&&(rest="/"+notHost.join(".")+rest);this.hostname=validParts.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase();ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);"/"!==rest[0]&&(rest="/"+rest)}}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae));rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(-1!==hash){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(-1!==qm){this.search=rest.substr(qm);this.query=rest.substr(qm+1);parseQueryString&&(this.query=querystring_parse(this.query));rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}rest&&(this.pathname=rest);slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/");if(this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);if(port){":"!==(port=port[0])&&(this.port=port.substr(1));host=host.substr(0,host.length-port.length)}host&&(this.hostname=host)};var util={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}};function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}var url_lib={resolve:function(source,relative){return urlParse(source,!1,!0).resolve(relative)},parse:function(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}},path_lib_dirname=function(path){"string"!=typeof path&&(path+="");if(0===path.length)return".";for(var code=path.charCodeAt(0),hasRoot=47===code,end=-1,matchedSlash=!0,i=path.length-1;1<=i;--i)if(47===(code=path.charCodeAt(i))){if(!matchedSlash){end=i;break}}else matchedSlash=!1;return-1===end?hasRoot?"/":".":hasRoot&&1===end?"/":path.slice(0,end)},path_lib_resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;-1<=i&&!resolvedAbsolute;i--){var path=0<=i?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");if(path){resolvedPath=path+"/"+resolvedPath;resolvedAbsolute="/"===path.charAt(0)}}return(resolvedAbsolute?"/":"")+(resolvedPath=function(parts,allowAboveRoot){for(var up=0,i=parts.length-1;0<=i;i--){var last=parts[i];if("."===last)parts.splice(i,1);else if(".."===last){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot)for(;up--;)parts.unshift("..");return parts}(function(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"))||"."},events=$({}),baseKey="",local_storage={setBaseKey:function(key){baseKey=key},set:function(key,value){key=baseKey+":"+key;try{localStorage[key]=JSON.stringify(value)}catch(e){}},get:function(key,def){var value;key=baseKey+":"+key;try{value=localStorage[key]}catch(e){}if(void 0===value)return def;try{var parsed=JSON.parse(value);return null==parsed?def:parsed}catch(err){return value||def}},remove:function(key){key=baseKey+":"+key;try{localStorage.removeItem(key)}catch(e){}}},started=!1,state={};function setState(newState){state.config=newState.config;state.basePath=newState.basePath;state.js=newState.js;state.$book=$(".book");state.root=url_lib.resolve(location.protocol+"//"+location.host,path_lib_dirname(path_lib_resolve(location.pathname.replace(/\/$/,"/index.html"),state.basePath))).replace(/\/?$/,"/")}var page={hasChanged:function(ctx){console.log("page has changed",ctx);setState(ctx);if(!started){started=!0;events.trigger("start",ctx.config)}events.trigger("page.change")},setState:setState,getState:function(){return state}},isPageReady=!1,onLoad=window.lsbook||[],lsbook={events:events,page:page,state:page.getState(),storage:local_storage,push:function(fn){isPageReady?fn():onLoad.push(fn)}};window.lsbook=lsbook;$(document).ready(function(){isPageReady=!0;$.each(onLoad,function(i,fn){fn()})});function toggleDropdown(e){$(e.currentTarget).parent().find(".dropdown-menu").toggleClass("open");e.stopPropagation();e.preventDefault()}function closeDropdown(e){$(".dropdown-menu").removeClass("open")}var dropdown_init=function(){$(document).on("click",".toggle-dropdown",toggleDropdown);$(document).on("click",".dropdown-menu",function(e){e.stopPropagation()});$(document).on("click",closeDropdown)};function bindShortcut(keys,fn){Mousetrap.bind(keys,function(e){fn();return!1})}var $chapters,$activeChapter,keyboard={init:function(){bindShortcut(["right"],function(e){navigation.goNext()});bindShortcut(["left"],function(e){navigation.goPrev()});bindShortcut(["s"],function(e){sidebar.toggle()})}},loading={show:function(p){lsbook.state.$book.addClass("is-loading");p.always(function(){lsbook.state.$book.removeClass("is-loading")});return p}},platform={isMobile:function(){return $(document).width()<=600},isSmallScreen:function(){return $(document).width()<=1240}},usePushState=void 0!==history.pushState;function getScroller(){return platform.isSmallScreen()?$(".book-body"):$(".body-inner")}function scrollToHash(hash){var $scroller=getScroller(),dest=0;if(function(id){return!!getScroller().find(id).length}(hash)){hash&&(dest=getElementTopPosition(hash));$scroller.unbind("scroll");$scroller.animate({scrollTop:dest},800,"swing",function(){$scroller.scroll(handleScrolling)});!function($chapter,hash){$chapter||hash||($chapter=$chapters.first());hash&&($chapter=1<$chapters.length?$chapters.filter(function(){return getChapterHash($(this))==hash}).first():$chapters.first());if($chapter.is($activeChapter))return;$activeChapter=$chapter;$chapters.removeClass("active");$chapter.addClass("active");hash=getChapterHash($chapter);var oldUri=window.location.pathname+window.location.hash,uri=window.location.pathname+hash;uri!=oldUri&&history.replaceState({path:uri},null,uri)}(null,hash)}}function isEmpty(element){return 0===element.length}function getElementTopPosition(id){var $scroller=getScroller(),$container=$scroller.find(".page-inner"),$el=$scroller.find(id),$parent=$el.offsetParent(),dest=0;if(function(arr,predicate){return 0<arr.length&&0<arr.filter(predicate).length}([$scroller,$container,$el,$parent],isEmpty))return 0;dest=$el.position().top;for(var i=0;i<10&&(!$parent.is($container)&&!$parent.is($parent.offsetParent()));i++){dest+=($el=$parent).position().top;$parent=$el.offsetParent()}return Math.floor(dest)}function getChapterHash($chapter){var hash,href,parts,$link=$chapter.children("a");$link.length&&(href=$link.attr("href"))&&1<(parts=href.split("#")).length&&(hash=parts[1]);return(hash=hash&&"#"+hash)||""}function handleScrolling(){var $scroller=getScroller(),scrollTop=$scroller.scrollTop(),scrollHeight=$scroller.prop("scrollHeight"),clientHeight=$scroller.prop("clientHeight"),nbChapters=$chapters.length,$chapter=null;$($chapters.get().reverse()).each(function(index){var titleId=getChapterHash($(this));titleId&&!$chapter&&getElementTopPosition(titleId)<=scrollTop&&($chapter=$(this));index!=nbChapters-1||$chapter||($chapter=$(this))});$chapter||scrollTop||($chapter=$chapters.first());scrollTop&&scrollHeight-scrollTop==clientHeight&&($chapter=$chapters.last())}var prevUri=location.href;function handleNavigation(relativeUrl,push){var prevUriParsed=url_lib.parse(prevUri),uri=url_lib.resolve(window.location.pathname,relativeUrl),uriParsed=url_lib.parse(uri),hash=uriParsed.hash,pathHasChanged=uriParsed.pathname!==prevUriParsed.pathname,isAbsolute=Boolean(uriParsed.hostname);if(usePushState&&!isAbsolute){if(!pathHasChanged){push&&history.pushState({path:uri},null,uri);return scrollToHash(hash)}prevUri=uri;var promise=$.Deferred(function(deferred){$.ajax({type:"GET",url:uri,cache:!0,headers:{"Access-Control-Expose-Headers":"X-Current-Location"},success:function(html,status,xhr){var responseURL=xhr.getResponseHeader("X-Current-Location")||uri;html=html.replace(/<(\/?)(html|head|body)([^>]*)>/gi,function(a,b,c,d){return"<"+b+"div"+(b?"":' data-element="'+c+'"')+d+">"});var $pageHead,$page=$(html),$pageBody=$page.find(".book");if(0===$pageBody.length){var err=new Error("无效的页面，正在重定向...");return deferred.reject(err)}push&&history.pushState({path:responseURL},null,responseURL);$pageHead=($page=$(html)).find("[data-element=head]");$pageBody=$page.find(".book");document.title=$pageHead.find("title").text();var $head=$("head");$head.find("link[rel=prev]").remove();$head.find("link[rel=next]").remove();$head.append($pageHead.find("link[rel=prev]"));$head.append($pageHead.find("link[rel=next]"));var bodyClass=$(".book").attr("class"),scrollPosition=$(".book-summary").scrollTop();$pageBody.toggleClass("with-summary",$(".book").hasClass("with-summary"));$(".book").replaceWith($pageBody);$(".book").attr("class",bodyClass);$(".book-summary").scrollTop(scrollPosition);lsbook.state.$book=$(".book");preparePage(!hash);hash&&scrollToHash(hash);deferred.resolve()}})}).promise();return loading.show(promise.fail(function(e){console.log(e)}))}location.href=relativeUrl}function updateNavigationPosition(){var bodyInnerWidth,pageWrapperWidth;bodyInnerWidth=parseInt($(".body-inner").css("width"),10);pageWrapperWidth=parseInt($(".page-wrapper").css("width"),10);$(".navigation-next").css("margin-right",bodyInnerWidth-pageWrapperWidth+"px");var $scroller=getScroller();$scroller.unbind("scroll");$scroller.scroll(handleScrolling)}function preparePage(resetScroll){var $pageWrapper=$(".book-body").find(".body-inner").find(".page-wrapper");updateNavigationPosition();$pageWrapper.focus();var $scroller=getScroller();!1!==resetScroll&&$scroller.scrollTop(0);1<($chapters=$(".book-summary .summary .chapter").filter(function(){var $link=$(this).children("a"),href=null;if(!$link.length)return!1;href=$link.attr("href").split("#")[0];var resolvedRef=url_lib.resolve(window.location.pathname,href);return decodeURI(window.location.pathname)==decodeURI(resolvedRef)})).length?$scroller.scroll(handleScrolling):$activeChapter=$chapters.first()}function handleLinkClick(e){var $this=$(this),target=$this.attr("target");if(!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)&&function(e){return 0===e.button}(e)&&!target){e.stopPropagation();e.preventDefault();var url=$this.attr("href");url&&handleNavigation(url,!0)}}var navigation={init:function(){$.ajaxSetup({cache:!1});history.replaceState({path:window.location.href},"");window.onpopstate=function(event){if(null!==event.state)return handleNavigation(event.state.path,!1)};$(document).on("click",".navigation-prev",handleLinkClick);$(document).on("click",".navigation-next",handleLinkClick);$(document).on("click",".summary [data-path] a",handleLinkClick);$(document).on("click",".page-inner a",handleLinkClick);$(window).resize(updateNavigationPosition);preparePage(!1)},goNext:function(){var url=$(".navigation-next").attr("href");url&&handleNavigation(url,!0)},goPrev:function(){var url=$(".navigation-prev").attr("href");url&&handleNavigation(url,!0)}};function toggleSidebar(_state,animation){if(null==lsbook.state||isOpen()!=_state){null==animation&&(animation=!0);lsbook.state.$book.toggleClass("without-animation",!animation);lsbook.state.$book.toggleClass("with-summary",_state);sessionStorage.setItem("sidebar",isOpen())}}function isOpen(){return lsbook.state.$book.hasClass("with-summary")}var sidebar={init:function(){platform.isMobile()||toggleSidebar("false"!==sessionStorage.getItem("sidebar"),!1);$(document).on("click",".book-summary li.chapter a",function(e){platform.isMobile()&&toggleSidebar(!1,!1)})},isOpen:isOpen,toggle:toggleSidebar,filter:function(paths){$(".book-summary").find("li").each(function(){var path=$(this).data("path"),st=null==paths||-1!==paths.indexOf(path);$(this).toggle(st);st&&$(this).parents("li").show()})}},buttons=[],BTN_ID=0;function defaultOnClick(e){e.preventDefault()}function updateButton(opts){var $result,$toolbar=$(".book-header"),$title=$toolbar.find("h1"),positionClass="pull-"+opts.position,$btn=$("<a>",{class:"btn",text:opts.text?" "+opts.text:"","aria-label":opts.label,href:"#"});$btn.click(opts.onClick);opts.icon&&$("<i>",{class:opts.icon}).prependTo($btn);if(opts.dropdown){var $container=$("<div>",{class:"dropdown "+positionClass+" "+opts.className});$btn.addClass("toggle-dropdown");$container.append($btn);var $menu=function(dropdown){var $menu=$("<div>",{class:"dropdown-menu",html:'<div class="dropdown-caret"><span class="caret-outer"></span><span class="caret-inner"></span></div>'});if("string"==typeof dropdown)$menu.append(dropdown);else{dropdown.map(function(group){return $.isArray(group)?group:[group]}).forEach(function(group){var $group=$("<div>",{class:"buttons"}),sizeClass="size-"+group.length;group.forEach(function(btn){btn=$.extend({text:"",className:"",onClick:defaultOnClick},btn||{});var $btn=$("<button>",{class:"button "+sizeClass+" "+btn.className,text:btn.text});$btn.click(btn.onClick);$group.append($btn)});$menu.append($group)})}return $menu}(opts.dropdown);$menu.addClass("dropdown-"+("right"==opts.position?"left":"right"));$container.append($menu);$result=$container}else{$btn.addClass(positionClass);$btn.addClass(opts.className);$result=$btn}$result.addClass("js-toolbar-action");$.isNumeric(opts.index)&&0<=opts.index?function(parent,selector,index,element){var lastIndex=parent.children(selector).length;index<0&&(index=Math.max(0,lastIndex+1+index));parent.append(element);index<lastIndex&&parent.children(selector).eq(index).before(parent.children(selector).last())}($toolbar,".btn, .dropdown, h1",opts.index,$result):$result.insertBefore($title)}function updateAllButtons(){$(".js-toolbar-action").remove();buttons.forEach(updateButton)}lsbook.events.on("page.change",function(){updateAllButtons()});var CHAPTER,collapse,expand,lsItem,toolbar={createButton:function(opts){opts=$.extend({label:"",icon:"",text:"",position:"left",className:"",onClick:defaultOnClick,dropdown:null,index:null,id:"btn-"+BTN_ID++},opts||{});buttons.push(opts);updateButton(opts);return opts.id},removeButton:function(id){buttons=$.grep(buttons,function(button){return button.id!=id});updateAllButtons()},removeButtons:function(ids){buttons=$.grep(buttons,function(button){return-1==ids.indexOf(button.id)});updateAllButtons()}};lsbook.events.on("start",function(){sidebar.init();keyboard.init();dropdown_init();navigation.init();toolbar.createButton({index:0,icon:"fa fa-align-justify",onClick:function(e){e.preventDefault();sidebar.toggle()}})});lsbook.keyboard=keyboard;lsbook.navigation=navigation;lsbook.sidebar=sidebar;lsbook.toolbar=toolbar;function loadFiles(files,fn){files.length||(files=[]);var head=document.head||document.getElementsByTagName("head")[0];!function loadFile(index){if(files.length>index){var fileref=document.createElement("script");fileref.setAttribute("type","text/javascript");fileref.setAttribute("src",files[index]);head.appendChild(fileref);index+=1;fileref.onload=function(){loadFile(index)}}else fn&&fn()}(0)}lsbook.events.bind("page.change",function(){function _init(){if("undefined"!=typeof mermaid){console.log("mermaid config");mermaid.initialize({startOnLoad:!0,flowchart:{useMaxWidth:!1,htmlLabels:!0},theme:"forest"});console.log("mermaid init");mermaid.init()}}"undefined"==typeof mermaid&&void 0!==lsbook.state.js.mermaid?loadFiles(lsbook.state.js.mermaid,_init):_init()});lsbook.events.bind("page.change",function(){$(".section").each(function(){$(this).click(function(){var target=$(this).attr("target"),show=$(this).hasClass("sec-show");$(this).toggleClass("sec-show",!show);$(this).children().toggleClass("fa-angle-up",!show).toggleClass("fa-angle-down",show);$("#"+target).toggleClass("in",!show).toggleClass("collapse",show)})})});lsbook.events.bind("page.change",function(){$(".spoiler").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})});CHAPTER=".chapter",collapse=function($chapter){if($chapter.length){$chapter.removeClass("expanded");lsItem()}},expand=function($chapter){if($chapter.length){$chapter.addClass("expanded");lsItem()}},lsItem=function(){var map=JSON.parse(sessionStorage.getItem("expChapters"))||{};if(!arguments.length)return $(CHAPTER).map(function(index,element){if(map[$(this).data("level")])return this});arguments[0].each(function(index,element){var level=$(this).data("level");map[level]=$(this).hasClass("expanded")});sessionStorage.setItem("expChapters",JSON.stringify(map))},lsbook.events.bind("page.change",function(){$(".articles").parent(CHAPTER).children("a, span").append($('<i class="exc-trigger fa"></i>').on("click",function(e){e.preventDefault();e.stopPropagation();toggle($(e.target).closest(CHAPTER))}));$(".chapter > span").on("click",function(e){e.preventDefault();e.stopPropagation();toggle($(e.target).closest(CHAPTER))});expand(lsItem());var activeChapter=$(".chapter.active");expand(activeChapter);expand(activeChapter.parents(CHAPTER))});function toggle($chapter){$chapter.hasClass("expanded")?collapse($chapter):expand($chapter)}lsbook.events.bind("start",function(e,config){var githubURL=config.github_url;githubURL&&lsbook.toolbar.createButton({icon:"fa fa-github",label:"GitHub",position:"right",onClick:function(){window.open(githubURL)}})});lsbook.events.bind("page.change",function(){function _init(){"undefined"!=typeof renderMathInElement&&renderMathInElement(document.body,{displayMode:!1})}"undefined"==typeof renderMathInElement&&void 0!==lsbook.state.js.katex?loadFiles(lsbook.state.js.katex,_init):_init()});lsbook.events.bind("page.change",function(){setTimeout("var _top = $('.active')[0].getBoundingClientRect().top;if (_top<0 || _top+40 > $('.book-summary')[0].getBoundingClientRect().height) {$('.active')[0].scrollIntoView({block: 'nearest', behavior: 'smooth'});}",500)});lsbook.events.bind("page.change",function(){function _init(){if("undefined"!=typeof Prism){Prism.plugins.NormalizeWhitespace.setDefaults({"remove-trailing":!0,"remove-indent":!0,"left-trim":!1,"right-trim":!0,"remove-initial-line-feed":!0});Prism.highlightAll()}}"undefined"==typeof Prism&&void 0!==lsbook.state.js.prism?loadFiles(lsbook.state.js.prism,_init):_init()});lsbook.events.bind("page.change",function(){var next_page_link=lsbook.state.config.next_page_link;if(next_page_link){(_link=document.createElement("link")).setAttribute("rel","prefetch");_link.setAttribute("href",next_page_link);document.getElementsByTagName("head")[0].appendChild(_link)}var previous_page_link=lsbook.state.config.previous_page_link;if(previous_page_link){var _link;(_link=document.createElement("link")).setAttribute("rel","prefetch");_link.setAttribute("href",previous_page_link);document.getElementsByTagName("head")[0].appendChild(_link)}});!function(){var $bookSearchResults,$searchList,$searchTitle,$searchResultsCount,$searchQuery,MAX_DESCRIPTION_SIZE=500,state=lsbook.state,INDEX_DATA={},usePushState=void 0!==window.history.pushState,$body=$("body");function escapeRegExp(keyword){return String(keyword).replace(/([-.*+?^${}()|[\]/\\])/g,"\\$1")}function query(originKeyword){if(null!=originKeyword&&""!==originKeyword.trim()){var keyword,results=[],index=-1;for(var page in INDEX_DATA){var store=INDEX_DATA[page];keyword=originKeyword.toLowerCase();var hit=!1;store.keywords&&~store.keywords.split(/\s+/).indexOf(keyword.split(":").pop())&&(/.:./.test(keyword)?keyword=keyword.split(":").slice(0,-1).join(":"):hit=!0);var keywordRe=new RegExp("("+escapeRegExp(keyword)+")","gi");(hit||~(index=store.body.toLowerCase().indexOf(keyword)))&&results.push({url:page,title:store.title,body:store.body.substr(Math.max(0,index-50),MAX_DESCRIPTION_SIZE).replace(keywordRe,'<span class="search-highlight-keyword">$1</span>')})}!function(res){$bookSearchResults=$("#book-search-results");$searchList=$bookSearchResults.find(".search-results-list");$searchTitle=$bookSearchResults.find(".search-results-title");$searchResultsCount=$searchTitle.find(".search-results-count");$searchQuery=$searchTitle.find(".search-query");$bookSearchResults.addClass("open");var noResults=0===res.count;$bookSearchResults.toggleClass("no-results",noResults);$searchList.empty();$searchResultsCount.text(res.count);$searchQuery.text(res.query);res.results.forEach(function(item){var $li=$("<li>",{class:"search-results-item"}),$title=$("<h3>"),$link=$("<a>",{href:lsbook.state.basePath+"/"+item.url+"?h="+encodeURIComponent(res.query),text:item.title,"data-is-search":1});$link[0].href.split("?")[0]===window.location.href.split("?")[0]&&$link[0].setAttribute("data-need-reload",1);var content=item.body.trim();content.length>MAX_DESCRIPTION_SIZE&&(content+="...");var $content=$("<p>").html(content);$link.appendTo($title);$title.appendTo($li);$content.appendTo($li);$li.appendTo($searchList)});$(".body-inner").scrollTop(0)}({count:results.length,query:keyword,results:results})}}function launchSearch(keyword){$body.addClass("with-search");$body.addClass("search-loading");!function(fn,wait){var timeout;return function(){var ctx=this,args=arguments;timeout=timeout||setTimeout(function(){timeout=null;fn.apply(ctx,args)},wait)}}(function(){query(keyword);$body.removeClass("search-loading")})()}function closeSearch(){$body.removeClass("with-search");$("#book-search-results").removeClass("open")}function bindSearch(){var $body=$("body");$body.on("keyup","#book-search-input input",function(e){if(13===e.keyCode&&usePushState){var uri=updateQueryString("q",$(this).val());window.history.pushState({path:uri},null,uri)}!function(){var keyword=$("#book-search-input input").val();if(0===keyword.length){closeSearch();$(".page-inner").unmark()}else launchSearch(keyword)}()});$body.on("blur","#book-search-input input",function(e){if(usePushState){var uri=updateQueryString("q",$(this).val());window.history.pushState({path:uri},null,uri)}})}lsbook.events.on("start",function(){bindSearch();$.getJSON(state.basePath+"/search_plus_index.json").then(function(data){INDEX_DATA=data;showResult();closeSearch()})});var markConfig={ignoreJoiners:!0,acrossElements:!0,separateWordSearch:!1},highLightPageInner=function(keyword){var pageInner=$(".page-inner");/(?:(.+)?\:)(.+)/.test(keyword)&&pageInner.mark(RegExp.$1,markConfig);pageInner.mark(keyword,markConfig);setTimeout(function(){var mark=$('mark[data-markjs="true"]');mark.length&&mark[0].scrollIntoView()},100)};function showResult(){var keyword,type;if(/\b(q|h)=([^&]+)/.test(window.location.search)){type=RegExp.$1;keyword=decodeURIComponent(RegExp.$2);"q"===type?launchSearch(keyword):highLightPageInner(keyword);$("#book-search-input input").val(keyword)}}lsbook.events.on("page.change",showResult);function updateQueryString(key,value){value=encodeURIComponent(value);var hash,url=window.location.href.replace(/([?&])(?:q|h)=([^&]+)(&|$)/,function(all,pre,value,end){return"&"===end?pre:""}),re=new RegExp("([?&])"+key+"=.*?(&|#|$)(.*)","gi");if(re.test(url)){if(null!=value)return url.replace(re,"$1"+key+"="+value+"$2$3");url=(hash=url.split("#"))[0].replace(re,"$1$3").replace(/(&|\?)$/,"");void 0!==hash[1]&&null!==hash[1]&&(url+="#"+hash[1]);return url}if(null==value)return url;var separator=-1!==url.indexOf("?")?"&":"?";url=(hash=url.split("#"))[0]+separator+key+"="+value;void 0!==hash[1]&&null!==hash[1]&&(url+="#"+hash[1]);return url}window.addEventListener("click",function(e){"A"===e.target.tagName&&e.target.getAttribute("data-need-reload")&&setTimeout(function(){window.location.reload()},100)},!0)}();!function(){var BUTTON_ID,fontState,MAX_SIZE=4,MIN_SIZE=0,THEMES=[{config:"white",text:"White",id:0},{config:"sepia",text:"Sepia",id:1},{config:"night",text:"Night",id:2}],FAMILIES=[{config:"serif",text:"Serif",id:0},{config:"sans",text:"Sans",id:1},{config:"ant",text:"Ant",id:2},{config:"ym",text:"YM",id:3}];function saveFontSettings(){lsbook.storage.set("fontState",fontState);update()}function enlargeFontSize(e){e.preventDefault();if(!(fontState.size>=MAX_SIZE)){fontState.size++;saveFontSettings()}}function resetFontSize(e){e.preventDefault();fontState.size=2;saveFontSettings()}function reduceFontSize(e){e.preventDefault();if(!(fontState.size<=MIN_SIZE)){fontState.size--;saveFontSettings()}}function changeFontFamily(configName,e){e&&e instanceof Event&&e.preventDefault();fontState.family=getFontFamilyId(configName);saveFontSettings()}function changeColorTheme(configName,e){e&&e instanceof Event&&e.preventDefault();var $book=lsbook.state.$book;0!==fontState.theme&&$book.removeClass("color-theme-"+fontState.theme);fontState.theme=getThemeId(configName);0!==fontState.theme&&$book.addClass("color-theme-"+fontState.theme);saveFontSettings()}function getFontFamilyId(configName){var configFamily=$.grep(FAMILIES,function(family){return family.config==configName})[0];return configFamily?configFamily.id:2}function getThemeId(configName){var configTheme=$.grep(THEMES,function(theme){return theme.config==configName})[0];return configTheme?configTheme.id:0}function update(){var $book=lsbook.state.$book;$(".font-settings .font-family-list li").removeClass("active");$(".font-settings .font-family-list li:nth-child("+(fontState.family+1)+")").addClass("active");$book[0].className=$book[0].className.replace(/\bfont-\S+/g,"");$book.addClass("font-size-"+fontState.size);$book.addClass("font-family-"+fontState.family);if(0!==fontState.theme){$book[0].className=$book[0].className.replace(/\bcolor-theme-\S+/g,"");$book.addClass("color-theme-"+fontState.theme)}}lsbook.events.bind("start",function(){!function(){BUTTON_ID&&lsbook.toolbar.removeButton(BUTTON_ID);BUTTON_ID=lsbook.toolbar.createButton({icon:"fa fa-font",label:"Font Settings",className:"font-settings",dropdown:[[{text:"A",className:"font-reduce",onClick:reduceFontSize},{text:"R",className:"font-reset",onClick:resetFontSize},{text:"A",className:"font-enlarge",onClick:enlargeFontSize}],$.map(FAMILIES,function(family){family.onClick=function(e){return changeFontFamily(family.config,e)};return family}),$.map(THEMES,function(theme){theme.onClick=function(e){return changeColorTheme(theme.config,e)};return theme})]})}();!function(){var configFamily=getFontFamilyId(),configTheme=getThemeId();fontState=lsbook.storage.get("fontState",{size:2,family:configFamily,theme:configTheme});update()}()});lsbook.fontsettings={enlargeFontSize:enlargeFontSize,reduceFontSize:reduceFontSize,setTheme:changeColorTheme,setFamily:changeFontFamily}}();""!==location.hash&&setTimeout("getScroller().animate({scrollTop: getElementTopPosition(location.hash)}, 800, 'swing')",1500);
//# sourceMappingURL=lsbook.min.js.map