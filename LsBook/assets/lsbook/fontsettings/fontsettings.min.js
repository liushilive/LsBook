require(["lsbook","jquery"],function(q,f){var j=4,e=0,s;var n;var c=[{config:"white",text:"White",id:0},{config:"sepia",text:"Sepia",id:1},{config:"night",text:"Night",id:2}];var a=[{config:"serif",text:"Serif",id:0},{config:"sans",text:"Sans",id:1}];function o(){return c}function i(w){c=w;k()}function h(){return a}function l(w){a=w;k()}function p(){q.storage.set("fontState",n);g()}function d(w){w.preventDefault();if(n.size>=j){return}n.size++;p()}function v(w){w.preventDefault();if(n.size<=e){return}n.size--;p()}function u(x,w){if(w&&w instanceof Event){w.preventDefault()}n.family=b(x);p()}function t(x,w){if(w&&w instanceof Event){w.preventDefault()}var y=q.state.$book;if(n.theme!==0){y.removeClass("color-theme-"+n.theme)}n.theme=m(x);if(n.theme!==0){y.addClass("color-theme-"+n.theme)}f(".prism_css").attr("disabled",true);f("#p_css_"+n.theme).attr("disabled",false);p()}function b(x){var w=f.grep(a,function(y){return y.config==x})[0];return(!!w)?w.id:0}function m(x){var w=f.grep(c,function(y){return y.config==x})[0];return(!!w)?w.id:0}function g(){var w=q.state.$book;f(".font-settings .font-family-list li").removeClass("active");f(".font-settings .font-family-list li:nth-child("+(n.family+1)+")").addClass("active");w[0].className=w[0].className.replace(/\bfont-\S+/g,"");w.addClass("font-size-"+n.size);w.addClass("font-family-"+n.family);if(n.theme!==0){w[0].className=w[0].className.replace(/\bcolor-theme-\S+/g,"");w.addClass("color-theme-"+n.theme);f(".prism_css").attr("disabled",true);f("#p_css_"+n.theme).attr("disabled",false)}}function r(x){var y=b(x.family),w=m(x.theme);n=q.storage.get("fontState",{size:x.size||2,family:y,theme:w});g()}function k(){if(!!s){q.toolbar.removeButton(s)}s=q.toolbar.createButton({icon:"fa fa-font",label:"Font Settings",className:"font-settings",dropdown:[[{text:"A",className:"font-reduce",onClick:v},{text:"A",className:"font-enlarge",onClick:d}],f.map(a,function(w){w.onClick=function(x){return u(w.config,x)};return w}),f.map(c,function(w){w.onClick=function(x){return t(w.config,x)};return w})]})}q.events.bind("start",function(y,w){var x=w.fontsettings;k();r(x)});q.fontsettings={enlargeFontSize:d,reduceFontSize:v,setTheme:t,setFamily:u,getThemes:o,setThemes:i,getFamilies:h,setFamilies:l}});